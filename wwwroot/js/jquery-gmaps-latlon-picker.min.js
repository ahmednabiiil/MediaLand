(function(n){window.console||(window.console={});window.console.log||(window.console.log=function(){});n.fn.gMapsLatLonPicker=function(){var t=this;t.params={defLat:21.54238,defLng:39.19797,defZoom:10,queryLocationNameWhenLatLngChanges:!0,queryElevationWhenLatLngChanges:!0,mapOptions:{mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,disableDoubleClickZoom:!0,zoomControlOptions:!0,streetViewControl:!1},strings:{markerText:"Drag this Marker",error_empty_field:"Couldn't find coordinates for this place",error_no_results:"Couldn't find coordinates for this place"},displayError:function(n){alert(n)}};t.vars={ID:null,LATLNG:null,map:null,marker:null,geocoder:null};var i=function(i){t.vars.marker.setPosition(i);t.vars.map.panTo(i);n(t.vars.cssID+".gllpZoom").val(t.vars.map.getZoom());n(t.vars.cssID+".gllLatLng").val(i.lat()+","+i.lng());n(t.vars.cssID).trigger("location_changed",n(t.vars.cssID));t.params.queryLocationNameWhenLatLngChanges&&u(i);t.params.queryElevationWhenLatLngChanges&&f(i)},u=function(i){var r=new google.maps.LatLng(i.lat(),i.lng());t.vars.geocoder.geocode({latLng:r},function(i,r){r==google.maps.GeocoderStatus.OK&&i[1]?n(t.vars.cssID+".gllpLocationName").val(i[1].formatted_address):n(t.vars.cssID+".gllpLocationName").val("");n(t.vars.cssID).trigger("location_name_changed",n(t.vars.cssID))})},f=function(i){var r=new google.maps.LatLng(i.lat(),i.lng()),u=[r],f={locations:u};t.vars.elevator.getElevationForLocations(f,function(i,r){r==google.maps.ElevationStatus.OK?i[0]?n(t.vars.cssID+".gllpElevation").val(i[0].elevation.toFixed(3)):n(t.vars.cssID+".gllpElevation").val(""):n(t.vars.cssID+".gllpElevation").val("");n(t.vars.cssID).trigger("elevation_changed",n(t.vars.cssID))})},r=function(r,u){if(r==""){u||t.params.displayError(t.params.strings.error_empty_field);return}t.vars.geocoder.geocode({address:r},function(r,f){f==google.maps.GeocoderStatus.OK?(n(t.vars.cssID+".gllpZoom").val(11),t.vars.map.setZoom(parseInt(n(t.vars.cssID+".gllpZoom").val())),i(r[0].geometry.location)):u||t.params.displayError(t.params.strings.error_no_results)})};return{init:function(u){n(u).attr("id")||(n(u).attr("name")?n(u).attr("id",n(u).attr("name")):n(u).attr("id","_MAP_"+Math.ceil(Math.random()*1e4)));t.vars.ID=n(u).attr("id");t.vars.cssID="#"+t.vars.ID+" ";t.params.defLat=n(t.vars.cssID+".gllLatLng").val()?n(t.vars.cssID+".gllLatLng").val().split(",",2)[0]:t.params.defLat;t.params.defLng=n(t.vars.cssID+".gllLatLng").val()?n(t.vars.cssID+".gllLatLng").val().split(",",2)[1]:t.params.defLng;t.params.defZoom=n(t.vars.cssID+".gllpZoom").val()?parseInt(n(t.vars.cssID+".gllpZoom").val()):t.params.defZoom;t.vars.LATLNG=new google.maps.LatLng(t.params.defLat,t.params.defLng);t.vars.MAPOPTIONS=t.params.mapOptions;t.vars.MAPOPTIONS.zoom=t.params.defZoom;t.vars.MAPOPTIONS.center=t.vars.LATLNG;t.vars.map=new google.maps.Map(n(t.vars.cssID+".gllpMap").get(0),t.vars.MAPOPTIONS);t.vars.geocoder=new google.maps.Geocoder;t.vars.elevator=new google.maps.ElevationService;t.vars.marker=new google.maps.Marker({position:t.vars.LATLNG,map:t.vars.map,title:t.params.strings.markerText,draggable:!0});google.maps.event.addListener(t.vars.map,"dblclick",function(n){i(n.latLng)});google.maps.event.addListener(t.vars.marker,"dragend",function(){i(t.vars.marker.position)});google.maps.event.addListener(t.vars.map,"zoom_changed",function(){n(t.vars.cssID+".gllpZoom").val(t.vars.map.getZoom());n(t.vars.cssID).trigger("location_changed",n(t.vars.cssID))});n(t.vars.cssID+".gllpUpdateButton").bind("click",function(){var r=n(t.vars.cssID+".gllLatLng").val().split(",",2)[0],u=n(t.vars.cssID+".gllLatLng").val().split(",",2)[1],f=new google.maps.LatLng(r,u);t.vars.map.setZoom(parseInt(n(t.vars.cssID+".gllpZoom").val()));i(f)});n(".gllpSearchField").keypress(function(i){var u=i.keyCode?i.keyCode:i.which;u=="13"&&(i.preventDefault(),r(n(t.vars.cssID+".gllpSearchField").val(),!1))});n(".gllpLinkField").keypress(function(t){var o=t.keyCode?t.keyCode:t.which,i,u,f,e;o=="13"&&(t.preventDefault(),i=new RegExp("@(.*),(.*),"),u=n(this).val().match(i),n(this).val().match(i)?(f=u[1],e=u[2],r(f+","+e,!1)):alert("please insert google map link"))});n(".gllpCurrentLocation").click(function(){"geolocation"in navigator?navigator.geolocation.getCurrentPosition(function(n){r(n.coords.latitude+","+n.coords.longitude,!1)}):console.log("Browser doesn't support geolocation!")});n(t.vars.cssID+".gllpSearchButton").bind("click",function(){r(n(t.vars.cssID+".gllpSearchField").val(),!1)});n(document).bind("gllp_perform_search",function(t,i){r(n(i).attr("string"),!0)});n(document).bind("gllp_update_fields",function(){var r=n(t.vars.cssID+".gllLatLng").val().split(",",2)[0],u=n(t.vars.cssID+".gllLatLng").val().split(",",2)[1],f=new google.maps.LatLng(r,u);t.vars.map.setZoom(parseInt(n(t.vars.cssID+".gllpZoom").val()));i(f)})},params:t.params}};n(document).ready(function(){n.gMapsLatLonPickerNoAutoInit||n(".gllpLatlonPicker").each(function(){$obj=n(document).gMapsLatLonPicker();$obj.init(n(this))})});n(document).bind("location_changed",function(t,i){console.log("changed: "+n(i).attr("id"))})})(jQuery);